(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();/**
 * Polymatic v0.0.10
 * @copyright Copyright 2025 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function xt(i){try{const t=localStorage.getItem(i);if(t)return t}catch{}try{const t=sessionStorage.getItem(i);if(t)return t}catch{}}function Z(i,t){let e=xt(i+"_exclude"),s=xt(i+"_include");try{if(e&&t.match(e))return!1}catch(n){console.log(n)}try{if(s&&t.match(s))return!0}catch(n){console.log(n)}return!1}function Nt(i,t){const e=Z("debug",i),s=Z("trace",i);return e?(...n)=>{t&&!t(...n)||(console.log(i,...n),s&&console.trace())}:()=>{}}function Ht(i,t){const e=Z("watch",i),s=Z("trace",i);return e?new Proxy(t,{set(n,r,o,h){return console.debug(i,".",r.toString(),n[r],"↬",o),s&&console.trace(),Reflect.set(n,r,o,h)}}):t}const mt=Nt("middleware.event",i=>!(i!=null&&i.endsWith("-move")||i==="hotsyncWorld")),wt=Nt("middleware.lifecycle");class m{constructor(){this.__handlers={},this.__children=[],this.__parent=null}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const e=this.__children.indexOf(t);e!==-1&&(this.__children.splice(e,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,wt("activate","+",this.constructor.name),this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}__detach(){if(this.__parent){wt("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,e){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=e}_consume(t,e){if(this._handle(t,e))return!0;for(let n=0;n<this.__children.length;n++)if(this.__children[n]._consume(t,e))return!0;return!1}_handle(t,e){if(!this.activated)return;const s=this.__handlers&&this.__handlers[t];return!!(s&&typeof s=="function"&&(mt(t,"→",this.constructor.name,e),s.call(this,e)===!0))}emit(t,e){this.activated&&(mt(t,"↑",this.constructor.name,e),this.__parent?this.__parent.emit(t,e):console.error(Error("Not active!")))}static activate(t,e){return gt.activate(t,e)}}class gt extends m{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=Ht("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,e){setTimeout(()=>{this._consume(t,e)})}static activate(t,e){const s=new gt;s.use(t),s._activate(e)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const e=t.__parent;return e&&"_deactivate"in e&&typeof e._deactivate=="function"?(e._deactivate(),!0):!1}}class R{constructor(){this._componentsById={}}static create(t){return new class extends R{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class vt{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends vt{constructor(){super(...arguments),this.key=t.key,this._drivers=t.drivers?[...t.drivers]:[]}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let s=0;s<t.length;s++){const n=t[s];if(typeof n!="object"||n===null)continue;const r=this.key(n);this._map[r]?delete this._map[r]:this._enterBuffer.push(n),this._updateBuffer[s]=n,this._mapBuffer[r]=n}for(const s in this._map)this._exitBuffer.push(this._map[s]),delete this._map[s];const e=this._map;this._map=this._mapBuffer,this._mapBuffer=e;for(let s=0;s<this._exitBuffer.length;s++){const n=this._exitBuffer[s],r=this.key(n);for(const o of this._drivers){if(o.filter(n)){const h=o._componentsById[r];o.exit(n,h)}delete o._componentsById[r]}}for(let s=0;s<this._enterBuffer.length;s++){const n=this._enterBuffer[s],r=this.key(n);for(const o of this._drivers)if(o.filter(n)){const h=o.enter(n);h&&(o._componentsById[r]=h)}}for(let s=0;s<this._updateBuffer.length;s++){if(typeof t[s]!="object"||t[s]===null)continue;const n=this._updateBuffer[s],r=this.key(n);for(const o of this._drivers)if(o.filter(n)){const h=o._componentsById[r];o.update(n,h)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}class tt{constructor(){this.memory=[]}static init(...t){const e=new tt;return t.length&&e.update(...t),e}update(...t){let e=this.memory.length===t.length;for(let s=0;s<t.length;s++)e=e&&this.memory[s]===t[s],this.memory[s]=t[s];return this.memory.length=t.length,!e}clear(){this.memory.length=0}}/**
 * Stage.js v1.0.0-alpha.17
 * @copyright Copyright 2025 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/stage.js/blob/main/LICENSE.md)
 */var jt=Math.random,Ft=Math.sqrt;function zt(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i==t?i:jt()*(t-i)+i}function Bt(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function Pt(i,t,e){return i<t?t:i>e?e:i}function Ut(i,t){return Ft(i*i+t*t)}var I=Object.create(Math);I.random=zt;I.wrap=Bt;I.clamp=Pt;I.length=Ut;I.rotate=Bt;I.limit=Pt;var bt=function(){function i(t,e,s,n,r,o){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,typeof t=="object"?this.reset(t):this.reset(t,e,s,n,r,o)}return i.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},i.prototype.clone=function(){return new i(this.a,this.b,this.c,this.d,this.e,this.f)},i.prototype.reset=function(t,e,s,n,r,o){return this._dirty=!0,typeof t=="object"?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=typeof t=="number"?t:1,this.b=typeof e=="number"?e:0,this.c=typeof s=="number"?s:0,this.d=typeof n=="number"?n:1,this.e=typeof r=="number"?r:0,this.f=typeof o=="number"?o:0),this},i.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},i.prototype.rotate=function(t){if(!t)return this;this._dirty=!0;var e=t?Math.cos(t):1,s=t?Math.sin(t):0,n=e*this.a-s*this.b,r=e*this.b+s*this.a,o=e*this.c-s*this.d,h=e*this.d+s*this.c,c=e*this.e-s*this.f,a=e*this.f+s*this.e;return this.a=n,this.b=r,this.c=o,this.d=h,this.e=c,this.f=a,this},i.prototype.translate=function(t,e){return!t&&!e?this:(this._dirty=!0,this.e+=t,this.f+=e,this)},i.prototype.scale=function(t,e){return!(t-1)&&!(e-1)?this:(this._dirty=!0,this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this)},i.prototype.skew=function(t,e){if(!t&&!e)return this;this._dirty=!0;var s=this.a+this.b*t,n=this.b+this.a*e,r=this.c+this.d*t,o=this.d+this.c*e,h=this.e+this.f*t,c=this.f+this.e*e;return this.a=s,this.b=n,this.c=r,this.d=o,this.e=h,this.f=c,this},i.prototype.concat=function(t){this._dirty=!0;var e=this.a*t.a+this.b*t.c,s=this.b*t.d+this.a*t.b,n=this.c*t.a+this.d*t.c,r=this.d*t.d+this.c*t.b,o=this.e*t.a+t.e+this.f*t.c,h=this.f*t.d+t.f+this.e*t.b;return this.a=e,this.b=s,this.c=n,this.d=r,this.e=o,this.f=h,this},i.prototype.inverse=function(){if(this._dirty){this._dirty=!1,this.inverted||(this.inverted=new i);var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted},i.prototype.map=function(t,e){return e=e||{x:0,y:0},e.x=this.a*t.x+this.c*t.y+this.e,e.y=this.b*t.x+this.d*t.y+this.f,e},i.prototype.mapX=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.a*t+this.c*e+this.e},i.prototype.mapY=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.b*t+this.d*e+this.f},i}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var at=function(i,t){return at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var n in s)s.hasOwnProperty(n)&&(e[n]=s[n])},at(i,t)};function X(i,t){at(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ct=function(){return ct=Object.assign||function(t){for(var e,s=1,n=arguments.length;s<n;s++){e=arguments[s];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},ct.apply(this,arguments)};function Lt(i,t,e,s){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function h(u){try{a(s.next(u))}catch(l){o(l)}}function c(u){try{a(s.throw(u))}catch(l){o(l)}}function a(u){u.done?r(u.value):n(u.value).then(h,c)}a((s=s.apply(i,[])).next())})}function Ct(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},s,n,r,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(a){return function(u){return c([a,u])}}function c(a){if(s)throw new TypeError("Generator is already executing.");for(;e;)try{if(s=1,n&&(r=a[0]&2?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,n=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){e.label=a[1];break}if(a[0]===6&&e.label<r[1]){e.label=r[1],r=a;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(a);break}r[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(i,e)}catch(u){a=[6,u],n=0}finally{s=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var Rt=Object.prototype.toString;function ut(i){var t=Rt.call(i);return t==="[object Function]"||t==="[object GeneratorFunction]"||t==="[object AsyncFunction]"}function et(i){return Rt.call(i)==="[object Object]"&&i.constructor===Object}const D={create:0,tick:0,component:0,draw:0,fps:0};var st=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)},z=function(){function i(){this.uid="texture:"+st(),this.sx=0,this.sy=0,this.dx=0,this.dy=0}return i.prototype.setSourceCoordinate=function(t,e){this.sx=t,this.sy=e},i.prototype.setSourceDimension=function(t,e){this.sw=t,this.sh=e},i.prototype.setDestinationCoordinate=function(t,e){this.dx=t,this.dy=e},i.prototype.setDestinationDimension=function(t,e){this.dw=t,this.dh=e},i.prototype.draw=function(t,e,s,n,r,o,h,c,a){var u,l,v,y,f,_,p,x;arguments.length>5?(u=this.sx+e,l=this.sy+s,v=n??this.sw,y=r??this.sh,f=this.dx+o,_=this.dy+h,p=c??this.dw,x=a??this.dh):arguments.length>1?(u=this.sx,l=this.sy,v=this.sw,y=this.sh,f=this.dx+e,_=this.dy+s,p=n??this.dw,x=r??this.dh):(u=this.sx,l=this.sy,v=this.sw,y=this.sh,f=this.dx,_=this.dy,p=this.dw,x=this.dh),this.drawWithNormalizedArgs(t,u,l,v,y,f,_,p,x)},i}(),Dt=function(i){X(t,i);function t(e,s){var n=i.call(this)||this;return n._pixelRatio=1,n.padding=0,typeof e=="object"&&n.setSourceImage(e,s),n}return t.prototype.setSourceImage=function(e,s){s===void 0&&(s=1),this._source=e,this._pixelRatio=s},t.prototype.setPadding=function(e){this.padding=e},t.prototype.getWidth=function(){return this._source.width/this._pixelRatio+(this.padding+this.padding)},t.prototype.getHeight=function(){return this._source.height/this._pixelRatio+(this.padding+this.padding)},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,s,n,r,o,h,c,a,u){var l=this._source;if(!(l===null||typeof l!="object")){r=r??this._source.width/this._pixelRatio,o=o??this._source.height/this._pixelRatio,a=a??r,u=u??o,h+=this.padding,c+=this.padding;var v=s*this._pixelRatio,y=n*this._pixelRatio,f=r*this._pixelRatio,_=o*this._pixelRatio;try{D.draw++,e.drawImage(l,v,y,f,_,h,c,a,u)}catch(p){this._draw_failed||(console.log("Unable to draw: ",l),console.log(p),this._draw_failed=!0)}}},t}(z),lt=function(i){X(t,i);function t(e){var s=i.call(this)||this;return s._source=e,s}return t.prototype.setSourceTexture=function(e){this._source=e},t.prototype.getWidth=function(){var e,s;return(s=(e=this.dw)!==null&&e!==void 0?e:this.sw)!==null&&s!==void 0?s:this._source.getWidth()},t.prototype.getHeight=function(){var e,s;return(s=(e=this.dh)!==null&&e!==void 0?e:this.sh)!==null&&s!==void 0?s:this._source.getHeight()},t.prototype.prerender=function(e){return this._source.prerender(e)},t.prototype.drawWithNormalizedArgs=function(e,s,n,r,o,h,c,a,u){var l=this._source;l===null||typeof l!="object"||l.draw(e,s,n,r,o,h,c,a,u)},t}(z),kt=function(i){X(t,i);function t(e){e===void 0&&(e={});var s=i.call(this)||this;return s.pipeSpriteTexture=function(n){var r=s._map,o=s._ppu,h=s._trim;if(n){n=Object.assign({},n),ut(r)&&(n=r(n)),o!=1&&(n.x*=o,n.y*=o,n.width*=o,n.height*=o,n.top*=o,n.bottom*=o,n.left*=o,n.right*=o),h!=0&&(n.x+=h,n.y+=h,n.width-=2*h,n.height-=2*h,n.top-=h,n.bottom-=h,n.left-=h,n.right-=h);var c=new lt(s);return c.top=n.top,c.bottom=n.bottom,c.left=n.left,c.right=n.right,c.setSourceCoordinate(n.x,n.y),c.setSourceDimension(n.width,n.height),c}},s.findSpriteDefinition=function(n){var r=s._textures;if(r){if(ut(r))return r(n);if(et(r))return r[n]}},s.select=function(n){if(!n)return new it(new lt(s));var r=s.findSpriteDefinition(n);if(r)return new it(r,s)},s.name=e.name,s._ppu=e.ppu||e.ratio||1,s._trim=e.trim||0,s._map=e.map||e.filter,s._textures=e.textures,typeof e.image=="object"&&et(e.image)?("src"in e.image?s._imageSrc=e.image.src:"url"in e.image&&(s._imageSrc=e.image.url),typeof e.image.ratio=="number"&&(s._pixelRatio=e.image.ratio)):(typeof e.imagePath=="string"?s._imageSrc=e.imagePath:typeof e.image=="string"&&(s._imageSrc=e.image),typeof e.imageRatio=="number"&&(s._pixelRatio=e.imageRatio)),qt(e),s}return t.prototype.load=function(){return Lt(this,void 0,void 0,function(){var e;return Ct(this,function(s){switch(s.label){case 0:return this._imageSrc?[4,Vt(this._imageSrc)]:[3,2];case 1:e=s.sent(),this.setSourceImage(e,this._pixelRatio),s.label=2;case 2:return[2]}})})},t}(Dt);function Vt(i){return console.debug&&console.debug("Loading image: "+i),new Promise(function(t,e){var s=new Image;s.onload=function(){console.debug&&console.debug("Image loaded: "+i),t(s)},s.onerror=function(n){console.error("Loading failed: "+i),e(n)},s.src=i})}function qt(i){"filter"in i&&console.warn("'filter' field of atlas definition is deprecated"),"cutouts"in i&&console.warn("'cutouts' field of atlas definition is deprecated"),"sprites"in i&&console.warn("'sprites' field of atlas definition is deprecated"),"factory"in i&&console.warn("'factory' field of atlas definition is deprecated"),"ratio"in i&&console.warn("'ratio' field of atlas definition is deprecated"),"imagePath"in i&&console.warn("'imagePath' field of atlas definition is deprecated"),"imageRatio"in i&&console.warn("'imageRatio' field of atlas definition is deprecated"),typeof i.image=="object"&&"url"in i.image&&console.warn("'image.url' field of atlas definition is deprecated")}function Gt(i){return typeof i=="object"&&et(i)&&typeof i.width=="number"&&typeof i.height=="number"}var it=function(){function i(t,e){this.selection=t,this.atlas=e}return i.prototype.resolve=function(t,e){if(t){if(Array.isArray(t))return this.resolve(t[0]);if(t instanceof z)return t;if(Gt(t))return this.atlas?this.atlas.pipeSpriteTexture(t):Q;if(typeof t=="object"&&et(t)&&typeof e<"u")return this.resolve(t[e]);if(typeof t=="function"&&ut(t))return this.resolve(t(e));if(typeof t=="string")return this.atlas?this.resolve(this.atlas.findSpriteDefinition(t)):Q}else return Q},i.prototype.one=function(t){return this.resolve(this.selection,t)},i.prototype.array=function(t){var e=Array.isArray(t)?t:[];if(Array.isArray(this.selection))for(var s=0;s<this.selection.length;s++)e[s]=this.resolve(this.selection[s]);else e[0]=this.resolve(this.selection);return e},i}(),Q=new(function(i){X(t,i);function t(){var e=i.call(this)||this;return e.setSourceDimension(0,0),e}return t.prototype.getWidth=function(){return 0},t.prototype.getHeight=function(){return 0},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,s,n,r,o,h,c,a,u){},t.prototype.setSourceCoordinate=function(e,s){},t.prototype.setSourceDimension=function(e,s){},t.prototype.setDestinationCoordinate=function(e,s){},t.prototype.setDestinationDimension=function(e,s){},t.prototype.draw=function(){},t}(z)),Kt=new it(Q),dt={},ft=[];function $t(i){return Lt(this,void 0,void 0,function(){var t;return Ct(this,function(e){switch(e.label){case 0:return i instanceof kt?t=i:t=new kt(i),t.name&&(dt[t.name]=t),ft.push(t),[4,t.load()];case 1:return e.sent(),[2,t]}})})}function yt(i){if(typeof i!="string")return new it(i);var t=null,e=i.indexOf(":");if(e>0&&i.length>e+1){var s=dt[i.slice(0,e)];t=s&&s.select(i.slice(e+1))}if(!t){var n=dt[i];t=n&&n.select()}if(!t)for(var r=0;r<ft.length&&(t=ft[r].select(i),!t);r++);return t||(console.error("Texture not found: "+i),t=Kt),t}var q=function(i){X(t,i);function t(e,s){var n=i.call(this)||this;return n._source=e,n._resizeMode=s,n}return t.prototype.getWidth=function(){var e;return(e=this.dw)!==null&&e!==void 0?e:this._source.getWidth()},t.prototype.getHeight=function(){var e;return(e=this.dh)!==null&&e!==void 0?e:this._source.getHeight()},t.prototype.prerender=function(e){return!1},t.prototype.drawWithNormalizedArgs=function(e,s,n,r,o,h,c,a,u){var l=this._source;if(!(l===null||typeof l!="object")){var v=a,y=u,f=Number.isFinite(l.left)?l.left:0,_=Number.isFinite(l.right)?l.right:0,p=Number.isFinite(l.top)?l.top:0,x=Number.isFinite(l.bottom)?l.bottom:0,Y=l.getWidth()-f-_,E=l.getHeight()-p-x;if(this._innerSize||(v=Math.max(v-f-_,0),y=Math.max(y-p-x,0)),p>0&&f>0&&l.draw(e,0,0,f,p,0,0,f,p),x>0&&f>0&&l.draw(e,0,E+p,f,x,0,y+p,f,x),p>0&&_>0&&l.draw(e,Y+f,0,_,p,v+f,0,_,p),x>0&&_>0&&l.draw(e,Y+f,E+p,_,x,v+f,y+p,_,x),this._resizeMode==="stretch")p>0&&l.draw(e,f,0,Y,p,f,0,v,p),x>0&&l.draw(e,f,E+p,Y,x,f,y+p,v,x),f>0&&l.draw(e,0,p,f,E,0,p,f,y),_>0&&l.draw(e,Y+f,p,_,E,v+f,p,_,y),l.draw(e,f,p,Y,E,f,p,v,y);else if(this._resizeMode==="tile")for(var O=f,V=v,N=void 0;V>0;){N=Math.min(Y,V),V-=Y;for(var H=p,ot=y,P=void 0;ot>0;)P=Math.min(E,ot),ot-=E,l.draw(e,f,p,N,P,O,H,N,P),V<=0&&(f&&l.draw(e,0,p,f,P,0,H,f,P),_&&l.draw(e,Y+f,p,_,P,O+N,H,_,P)),H+=P;p&&l.draw(e,f,0,N,p,O,0,N,p),x&&l.draw(e,f,E+p,N,x,O,H,N,x),O+=N}}},t}(z);function Mt(){return typeof window<"u"&&window.devicePixelRatio||1}function Jt(i){return i&&(i==="cover"||i==="contain"||i==="fill"||i==="in"||i==="in-pad"||i==="out"||i==="out-crop")}var g=0,Qt=function(){function i(t){this.uid="pin:"+st(),this._directionX=1,this._directionY=1,this._owner=t,this._parent=null,this._relativeMatrix=new bt,this._absoluteMatrix=new bt,this.reset()}return i.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=0,this._pivotY=0,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++g,this._ts_transform=++g,this._ts_matrix=++g},i.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++g),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++g),this},i.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},i.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var e=this._absoluteMatrix;return e.reset(this.relativeMatrix()),this._parent&&e.concat(this._parent._absoluteMatrix),this._ts_matrix=++g,e},i.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var e=this._relativeMatrix;if(e.identity(),this._pivoted&&e.translate(-this._pivotX*this._width,-this._pivotY*this._height),e.scale(this._scaleX*this._directionX,this._scaleY*this._directionY),e.skew(this._skewX,this._skewY),e.rotate(this._rotation),this._pivoted&&e.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var s=void 0,n=void 0;e.a>0&&e.c>0||e.a<0&&e.c<0?(s=0,n=e.a*this._width+e.c*this._height):(s=e.a*this._width,n=e.c*this._height),s>n?(this._boxX=n,this._boxWidth=s-n):(this._boxX=s,this._boxWidth=n-s),e.b>0&&e.d>0||e.b<0&&e.d<0?(s=0,n=e.b*this._width+e.d*this._height):(s=e.b*this._width,n=e.d*this._height),s>n?(this._boxY=n,this._boxHeight=s-n):(this._boxY=s,this._boxHeight=n-s)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth*this._directionX,this._y-=this._boxY+this._handleY*this._boxHeight*this._directionY,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),e.translate(this._x,this._y),this._relativeMatrix},i.prototype.get=function(t){if(typeof Tt[t]=="function")return Tt[t](this)},i.prototype.set=function(t,e){if(typeof t=="string")typeof G[t]=="function"&&typeof e<"u"&&G[t](this,e);else if(typeof t=="object")for(e in t)typeof G[e]=="function"&&typeof t[e]<"u"&&G[e](this,t[e],t);return this._owner&&(this._owner._ts_pin=++g,this._owner.touch()),this},i.prototype.fit=function(t,e,s){this._ts_transform=++g,s==="contain"&&(s="in-pad"),s==="cover"&&(s="out-crop"),typeof t=="number"&&(this._scaleX=t/this._unscaled_width,this._width=this._unscaled_width),typeof e=="number"&&(this._scaleY=e/this._unscaled_height,this._height=this._unscaled_height),typeof t=="number"&&typeof e=="number"&&typeof s=="string"&&(s==="fill"||(s==="out"||s==="out-crop"?this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY):(s==="in"||s==="in-pad")&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY))),(s==="out-crop"||s==="in-pad")&&(this._width=t/this._scaleX,this._height=e/this._scaleY))},i}(),Tt={alpha:function(i){return i._alpha},textureAlpha:function(i){return i._textureAlpha},width:function(i){return i._width},height:function(i){return i._height},boxWidth:function(i){return i._boxWidth},boxHeight:function(i){return i._boxHeight},scaleX:function(i){return i._scaleX},scaleY:function(i){return i._scaleY},skewX:function(i){return i._skewX},skewY:function(i){return i._skewY},rotation:function(i){return i._rotation},pivotX:function(i){return i._pivotX},pivotY:function(i){return i._pivotY},offsetX:function(i){return i._offsetX},offsetY:function(i){return i._offsetY},alignX:function(i){return i._alignX},alignY:function(i){return i._alignY},handleX:function(i){return i._handleX},handleY:function(i){return i._handleY}},G={alpha:function(i,t){i._alpha=t},textureAlpha:function(i,t){i._textureAlpha=t},width:function(i,t){i._unscaled_width=t,i._width=t,i._ts_transform=++g},height:function(i,t){i._unscaled_height=t,i._height=t,i._ts_transform=++g},scale:function(i,t){i._scaleX=t,i._scaleY=t,i._ts_transform=++g},scaleX:function(i,t){i._scaleX=t,i._ts_transform=++g},scaleY:function(i,t){i._scaleY=t,i._ts_transform=++g},skew:function(i,t){i._skewX=t,i._skewY=t,i._ts_transform=++g},skewX:function(i,t){i._skewX=t,i._ts_transform=++g},skewY:function(i,t){i._skewY=t,i._ts_transform=++g},rotation:function(i,t){i._rotation=t,i._ts_transform=++g},pivot:function(i,t){i._pivotX=t,i._pivotY=t,i._pivoted=!0,i._ts_transform=++g},pivotX:function(i,t){i._pivotX=t,i._pivoted=!0,i._ts_transform=++g},pivotY:function(i,t){i._pivotY=t,i._pivoted=!0,i._ts_transform=++g},offset:function(i,t){i._offsetX=t,i._offsetY=t,i._ts_translate=++g},offsetX:function(i,t){i._offsetX=t,i._ts_translate=++g},offsetY:function(i,t){i._offsetY=t,i._ts_translate=++g},align:function(i,t){this.alignX(i,t),this.alignY(i,t)},alignX:function(i,t){i._alignX=t,i._aligned=!0,i._ts_translate=++g,this.handleX(i,t)},alignY:function(i,t){i._alignY=t,i._aligned=!0,i._ts_translate=++g,this.handleY(i,t)},handle:function(i,t){this.handleX(i,t),this.handleY(i,t)},handleX:function(i,t){i._handleX=t,i._handled=!0,i._ts_translate=++g},handleY:function(i,t){i._handleY=t,i._handled=!0,i._ts_translate=++g},resizeMode:function(i,t,e){e&&(t=="in"?t="in-pad":t=="out"&&(t="out-crop"),i.fit(e.resizeWidth,e.resizeHeight,t))},resizeWidth:function(i,t,e){(!e||!e.resizeMode)&&i.fit(t,null)},resizeHeight:function(i,t,e){(!e||!e.resizeMode)&&i.fit(null,t)},scaleMode:function(i,t,e){e&&i.fit(e.scaleWidth,e.scaleHeight,t)},scaleWidth:function(i,t,e){(!e||!e.scaleMode)&&i.fit(t,null)},scaleHeight:function(i,t,e){(!e||!e.scaleMode)&&i.fit(null,t)},matrix:function(i,t){this.scaleX(i,t.a),this.skewX(i,t.c/t.d),this.skewY(i,t.b/t.a),this.scaleY(i,t.d),this.offsetX(i,t.e),this.offsetY(i,t.f),this.rotation(i,0)}};function Zt(i){return i}var St={},It={},Wt={},te=function(){function i(){}return i.get=function(t,e){if(e=e||Zt,typeof t=="function")return t;if(typeof t!="string")return e;var s=St[t];if(s)return s;var n=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(t);if(!n||!n.length)return e;var r=n[1],o=Wt[r],h=n[3],c=It[h],a=n[5];if(!o)s=e;else if("fn"in o&&typeof o.fn=="function")s=o.fn;else if("fc"in o&&typeof o.fc=="function"){var u=a?a.replace(/\s+/,"").split(","):void 0;s=o.fc.apply(o.fc,u)}else s=e;return c&&(s=c(s)),St[t]=s,s},i}();function nt(i,t){It[i]=t}function M(i){for(var t=i.name.split(/\s+/),e=0;e<t.length;e++){var s=t[e];s&&(Wt[s]=i)}}nt("in",function(i){return i});nt("out",function(i){return function(t){return 1-i(1-t)}});nt("in-out",function(i){return function(t){return t<.5?i(2*t)/2:1-i(2*(1-t))/2}});nt("out-in",function(i){return function(t){return t<.5?1-i(2*(1-t))/2:i(2*t)/2}});M({name:"linear",fn:function(i){return i}});M({name:"quad",fn:function(i){return i*i}});M({name:"cubic",fn:function(i){return i*i*i}});M({name:"quart",fn:function(i){return i*i*i*i}});M({name:"quint",fn:function(i){return i*i*i*i*i}});M({name:"sin sine",fn:function(i){return 1-Math.cos(i*Math.PI/2)}});M({name:"exp expo",fn:function(i){return i==0?0:Math.pow(2,10*(i-1))}});M({name:"circle circ",fn:function(i){return 1-Math.sqrt(1-i*i)}});M({name:"bounce",fn:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375}});M({name:"poly",fc:function(i){return function(t){return Math.pow(t,i)}}});M({name:"elastic",fc:function(i,t){t=t||.45,i=i||1;var e=t/(2*Math.PI)*Math.asin(1/i);return function(s){return 1+i*Math.pow(2,-10*s)*Math.sin((s-e)*(2*Math.PI)/t)}}});M({name:"back",fc:function(i){return i=typeof i<"u"?i:1.70158,function(t){return t*t*((i+1)*t-i)}}});var ee=function(){function i(t,e){e===void 0&&(e={}),this.uid="transition:"+st(),this._ending=[],this._end={},this._duration=e.duration||400,this._delay=e.delay||0,this._owner=t,this._time=0}return i.prototype.tick=function(t,e,s,n){if(this._time+=e,!(this._time<this._delay)){var r=this._time-this._delay;if(!this._start){this._start={};for(var o in this._end)this._start[o]=this._owner.pin(o)}var h=Math.min(r/this._duration,1),c=h>=1;typeof this._easing=="function"&&(h=this._easing(h));var a=1-h;for(var o in this._end)this._owner.pin(o,this._start[o]*a+this._end[o]*h);return c}},i.prototype.finish=function(){var t=this;return this._ending.forEach(function(e){try{e.call(t._owner)}catch(s){console.error(s)}}),this._next},i.prototype.tween=function(t,e){var s;return typeof t=="object"&&t!==null?s=t:(s={},typeof t=="number"&&(s.duration=t,typeof e=="number"&&(s.delay=e))),this._next=new i(this._owner,s)},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.delay=function(t){return this._delay=t,this},i.prototype.ease=function(t){return this._easing=te.get(t),this},i.prototype.done=function(t){return this._ending.push(t),this},i.prototype.hide=function(){return this._ending.push(function(){this.hide()}),this._hide=!0,this},i.prototype.remove=function(){return this._ending.push(function(){this.remove()}),this._remove=!0,this},i.prototype.pin=function(t,e){if(typeof t=="object")for(var s in t)At(this._owner,this._end,s,t[s]);else typeof e<"u"&&At(this._owner,this._end,t,e);return this},i.prototype.then=function(t){return this.done(t),this},i.prototype.clear=function(t){return this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i}();function At(i,t,e,s){typeof i.pin(e)=="number"?t[e]=s:typeof i.pin(e+"X")=="number"&&typeof i.pin(e+"Y")=="number"&&(t[e+"X"]=s,t[e+"Y"]=s)}var b=0;D.create=0;function T(i){if(i&&i instanceof B)return i;throw"Invalid component: "+i}function W(){return new B}function K(i){return new B().row(i).label("Row")}function ie(i){return new B().column(i).label("Column")}var B=function(){function i(){var t=this;this.uid="component:"+st(),this._label="",this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._visible=!0,this._alpha=1,this._padding=0,this._spacing=0,this._pin=new Qt(this),this._listeners={},this._attrs={},this._flags={},this._transitions=[],this._tickBefore=[],this._tickAfter=[],this.MAX_ELAPSE=1/0,this.renderedBefore=!1,this._transitionTickInitied=!1,this._transitionTickLastTime=0,this._transitionTick=function(e,s,n){if(!t._transitions.length)return!1;var r=t._transitionTickLastTime!==n;if(t._transitionTickLastTime=s,r)return!0;var o=t._transitions[0],h=o.tick(t,e,s,n);if(h){o===t._transitions[0]&&t._transitions.shift();var c=o.finish();c&&t._transitions.unshift(c)}return!0},D.create++,this instanceof i&&this.label(this.constructor.name)}return i.prototype.matrix=function(t){return t===void 0&&(t=!1),t===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},i.prototype.getPixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),s=e?Math.max(Math.abs(e.a),Math.abs(e.b))/Mt():1;return s},i.prototype.getDevicePixelRatio=function(){var t,e=(t=this._parent)===null||t===void 0?void 0:t.matrix(),s=e?Math.max(Math.abs(e.a),Math.abs(e.b)):1;return s},i.prototype.getLogicalPixelRatio=function(){return this.getDevicePixelRatio()/Mt()},i.prototype.pin=function(t,e){if(typeof t=="object")return this._pin.set(t),this;if(typeof t=="string")return typeof e>"u"?this._pin.get(t):(this._pin.set(t,e),this);if(typeof t>"u")return this._pin},i.prototype.fit=function(t,e,s){return typeof t=="object"&&(s=e,e=t.y,t=t.x),this._pin.fit(t,e,s),this},i.prototype.scaleTo=function(t,e,s){return this.fit(t,e,s)},i.prototype.toString=function(){return"["+this._label+"]"},i.prototype.id=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.label=function(t){return typeof t>"u"?this._label:(this._label=t,this)},i.prototype.attr=function(t,e){return typeof e>"u"?this._attrs!==null?this._attrs[t]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[t]=e,this)},i.prototype.visible=function(t){return typeof t>"u"?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++b),this._ts_pin=++b,this.touch(),this)},i.prototype.hide=function(){return this.visible(!1),this},i.prototype.show=function(){return this.visible(!0),this},i.prototype.parent=function(){return this._parent},i.prototype.next=function(t){for(var e=this._next;e&&t&&!e._visible;)e=e._next;return e},i.prototype.prev=function(t){for(var e=this._prev;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.first=function(t){for(var e=this._first;e&&t&&!e._visible;)e=e._next;return e},i.prototype.last=function(t){for(var e=this._last;e&&t&&!e._visible;)e=e._prev;return e},i.prototype.visit=function(t,e){var s=t.reverse,n=t.visible;if(!(t.start&&t.start(this,e))){for(var r,o=s?this.last(n):this.first(n);r=o;)if(o=s?r.prev(n):r.next(n),r.visit(t,e))return!0;return t.end&&t.end(this,e)}},i.prototype.append=function(t,e){if(Array.isArray(t))for(var s=0;s<t.length;s++)i.append(this,t[s]);else if(typeof e<"u")for(var s=0;s<arguments.length;s++)i.append(this,arguments[s]);else typeof t<"u"&&i.append(this,t);return this},i.prototype.prepend=function(t,e){if(Array.isArray(t))for(var s=t.length-1;s>=0;s--)i.prepend(this,t[s]);else if(typeof e<"u")for(var s=arguments.length-1;s>=0;s--)i.prepend(this,arguments[s]);else typeof t<"u"&&i.prepend(this,t);return this},i.prototype.appendTo=function(t){return i.append(t,this),this},i.prototype.prependTo=function(t){return i.prepend(t,this),this},i.prototype.insertNext=function(t,e){if(Array.isArray(t))for(var s=0;s<t.length;s++)i.insertAfter(t[s],this);else if(typeof e<"u")for(var s=0;s<arguments.length;s++)i.insertAfter(arguments[s],this);else typeof t<"u"&&i.insertAfter(t,this);return this},i.prototype.insertPrev=function(t,e){if(Array.isArray(t))for(var s=t.length-1;s>=0;s--)i.insertBefore(t[s],this);else if(typeof e<"u")for(var s=arguments.length-1;s>=0;s--)i.insertBefore(arguments[s],this);else typeof t<"u"&&i.insertBefore(t,this);return this},i.prototype.insertAfter=function(t){return i.insertAfter(this,t),this},i.prototype.insertBefore=function(t){return i.insertBefore(this,t),this},i.append=function(t,e){T(e),T(t),e.remove(),t._last&&(t._last._next=e,e._prev=t._last),e._parent=t,t._last=e,t._first||(t._first=e),e._parent._flag(e,!0),e._ts_parent=++b,t._ts_children=++b,t.touch()},i.prepend=function(t,e){T(e),T(t),e.remove(),t._first&&(t._first._prev=e,e._next=t._first),e._parent=t,t._first=e,t._last||(t._last=e),e._parent._flag(e,!0),e._ts_parent=++b,t._ts_children=++b,t.touch()},i.insertBefore=function(t,e){T(t),T(e),t.remove();var s=e._parent,n=e._prev;s&&(e._prev=t,n&&(n._next=t)||s&&(s._first=t),t._parent=s,t._prev=n,t._next=e,t._parent._flag(t,!0),t._ts_parent=++b,t.touch())},i.insertAfter=function(t,e){T(t),T(e),t.remove();var s=e._parent,n=e._next;s&&(e._next=t,n&&(n._prev=t)||s&&(s._last=t),t._parent=s,t._prev=e,t._next=n,t._parent._flag(t,!0),t._ts_parent=++b,t.touch())},i.prototype.remove=function(t,e){if(typeof t<"u"){if(Array.isArray(t))for(var s=0;s<t.length;s++)T(t[s]).remove();else if(typeof e<"u")for(var s=0;s<arguments.length;s++)T(arguments[s]).remove();else T(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++b,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++b,this},i.prototype.empty=function(){for(var t=null,e=this._first;t=e;)e=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++b,this.touch(),this},i.prototype.touch=function(){return this._ts_touch=++b,this._parent&&this._parent.touch(),this},i.prototype._flag=function(t,e){if(typeof e>"u")return this._flags!==null&&this._flags[t]||0;if(typeof t=="string"&&(e?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(this._flags[t]==1&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),typeof t=="object"&&t._flags)for(var s in t._flags)t._flags[s]>0&&this._flag(s,e);return this},i.prototype.hitTest=function(t){var e=this._pin._width,s=this._pin._height;return t.x>=0&&t.x<=e&&t.y>=0&&t.y<=s},i.prototype.prerender=function(){if(this._visible){this.prerenderTexture();for(var t,e=this._first;t=e;)e=t._next,t.prerender()}},i.prototype.prerenderTexture=function(){},i.prototype.render=function(t){if(this._visible){D.component++;var e=this.matrix();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var s=this._pin._textureAlpha*this._alpha;t.globalAlpha!=s&&(t.globalAlpha=s),this.renderedBefore||this.prerenderTexture(),this.renderedBefore=!0,this.renderTexture(t),t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var n,r=this._first;n=r;)r=n._next,n.render(t)}},i.prototype.renderTexture=function(t){},i.prototype._tick=function(t,e,s){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var n=!1;if(this._tickBefore!==null)for(var r=0;r<this._tickBefore.length;r++){D.tick++;var o=this._tickBefore[r];n=o.call(this,t,e,s)===!0||n}for(var h,c=this._first;h=c;)c=h._next,h._flag("_tick")&&(n=h._tick(t,e,s)===!0?!0:n);if(this._tickAfter!==null)for(var r=0;r<this._tickAfter.length;r++){D.tick++;var o=this._tickAfter[r];n=o.call(this,t,e,s)===!0||n}return n}},i.prototype.tick=function(t,e){var s,n;if(e===void 0&&(e=!1),typeof t=="function"){e?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(t)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(t));var r=((s=this._tickAfter)===null||s===void 0?void 0:s.length)>0||((n=this._tickBefore)===null||n===void 0?void 0:n.length)>0;this._flag("_tick",r)}},i.prototype.untick=function(t){if(typeof t=="function"){var e;this._tickBefore!==null&&(e=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(e,1),this._tickAfter!==null&&(e=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(e,1)}},i.prototype.timeout=function(t,e){this.setTimeout(t,e)},i.prototype.setTimeout=function(t,e){function s(n){if((e-=n)<0)this.untick(s),t.call(this);else return!0}return this.tick(s),s},i.prototype.clearTimeout=function(t){this.untick(t)},i.prototype.on=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var s=0;s<t.length;s++)this.on(t[s],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var s=0;s<t.length;s++)this._on(t[s],e)}else typeof t=="string"&&this._on(t,e);return this},i.prototype._on=function(t,e){typeof t!="string"&&typeof e!="function"||(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._flag(t,!0))},i.prototype.off=function(t,e){if(!t||!t.length||typeof e!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var s=0;s<t.length;s++)this.off(t[s],e);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var s=0;s<t.length;s++)this._off(t[s],e)}else typeof t=="string"&&this._off(t,e);return this},i.prototype._off=function(t,e){if(!(typeof t!="string"&&typeof e!="function")){var s=this._listeners[t];if(!(!s||!s.length)){var n=s.indexOf(e);n>=0&&(s.splice(n,1),this._flag(t,!1))}}},i.prototype.listeners=function(t){return this._listeners[t]},i.prototype.publish=function(t,e){var s=this.listeners(t);if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].apply(this,e);return s.length},i.prototype.trigger=function(t,e){return this.publish(t,e),this},i.prototype.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},i.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},i.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},i.prototype.offset=function(t,e){return typeof t=="object"&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},i.prototype.rotate=function(t){return this.pin("rotation",t),this},i.prototype.skew=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},i.prototype.scale=function(t,e){return typeof t=="object"?(e=t.y,t=t.x):typeof e>"u"&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},i.prototype.alpha=function(t,e){return this.pin("alpha",t),typeof e<"u"&&this.pin("textureAlpha",e),this},i.prototype.tween=function(t,e,s){var n;typeof t=="object"&&t!==null?n=t:(n={},typeof t=="number"?(n.duration=t,typeof e=="number"?(n.delay=e,typeof s=="boolean"&&(n.append=s)):typeof e=="boolean"&&(n.append=e)):typeof t=="boolean"&&(n.append=t)),this._transitionTickInitied||(this.tick(this._transitionTick,!0),this._transitionTickInitied=!0),this.touch(),n.append||(this._transitions.length=0);var r=new ee(this,n);return this._transitions.push(r),r},i.prototype.row=function(t){return this.align("row",t),this},i.prototype.column=function(t){return this.align("column",t),this},i.prototype.align=function(t,e){var s=this;return this._padding=this._padding,this._spacing=this._spacing,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(s._mo_seq!=s._ts_touch){s._mo_seq=s._ts_touch;var n=s._mo_seqAlign!=s._ts_children;s._mo_seqAlign=s._ts_children;for(var r=0,o=0,h,c=s.first(!0),a=!0;h=c;){c=h.next(!0),h.matrix(!0);var u=h.pin("boxWidth"),l=h.pin("boxHeight");t=="column"?(!a&&(o+=s._spacing),h.pin("offsetY")!=o&&h.pin("offsetY",o),r=Math.max(r,u),o=o+l,n&&h.pin("alignX",e)):t=="row"&&(!a&&(r+=s._spacing),h.pin("offsetX")!=r&&h.pin("offsetX",r),r=r+u,o=Math.max(o,l),n&&h.pin("alignY",e)),a=!1}r+=2*s._padding,o+=2*s._padding,s.pin("width")!=r&&s.pin("width",r),s.pin("height")!=o&&s.pin("height",o)}}),this},i.prototype.box=function(){return this.minimize()},i.prototype.layer=function(){return this.maximize()},i.prototype.minimize=function(){var t=this;return this._padding=this._padding,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(t._mo_box!=t._ts_touch){t._mo_box=t._ts_touch;for(var e=0,s=0,n,r=t.first(!0);n=r;){r=n.next(!0),n.matrix(!0);var o=n.pin("boxWidth"),h=n.pin("boxHeight");e=Math.max(e,o),s=Math.max(s,h)}e+=2*t._padding,s+=2*t._padding,t.pin("width")!=e&&t.pin("width",e),t.pin("height")!=s&&t.pin("height",s)}}),this},i.prototype.maximize=function(){var t=this;return this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){var e=t.parent();if(e){var s=e.pin("width");t.pin("width")!=s&&t.pin("width",s);var n=e.pin("height");t.pin("height")!=n&&t.pin("height",n)}},!0),this},i.prototype.padding=function(t){return this._padding=t,this},i.prototype.spacing=function(t){return this._spacing=t,this},i}();function S(i){var t=new rt;return i&&t.texture(i),t}var rt=function(i){X(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._image=null,e._tiled=!1,e._stretched=!1,e.prerenderContext={},e.label("Sprite"),e}return t.prototype.texture=function(e){return this._image=yt(e).one(),this._image?(this.pin("width",this._image.getWidth()),this.pin("height",this._image.getHeight()),this._tiled?this._texture=new q(this._image,"tile"):this._stretched?this._texture=new q(this._image,"stretch"):this._texture=new lt(this._image)):(this.pin("width",0),this.pin("height",0),this._texture=null),this},t.prototype.image=function(e){return this.texture(e)},t.prototype.tile=function(e){this._tiled=!0;var s=new q(this._image,"tile");return this._texture=s,this},t.prototype.stretch=function(e){this._stretched=!0;var s=new q(this._image,"stretch");return this._texture=s,this},t.prototype.prerenderTexture=function(){if(this._image){var e=this.getDevicePixelRatio();this.prerenderContext.pixelRatio=e;var s=this._image.prerender(this.prerenderContext);if(s===!0){var n=this._image.getWidth(),r=this._image.getHeight();this.size(n,r)}}},t.prototype.renderTexture=function(e){this._texture&&(this._texture._resizeMode&&(this._texture.dw=this.pin("width"),this._texture.dh=this.pin("height")),this._texture.draw(e))},t}(B);(function(i){X(t,i);function t(){var e=i.call(this,document.createElement("canvas"))||this;return e._lastPixelRatio=0,e}return t.prototype.setSize=function(e,s,n){n===void 0&&(n=1),this._source.width=e*n,this._source.height=s*n,this._pixelRatio=n},t.prototype.getContext=function(e,s){return e===void 0&&(e="2d"),this._source.getContext(e,s)},t.prototype.getDevicePixelRatio=function(){return this._lastPixelRatio},t.prototype.getOptimalPixelRatio=function(){return this.getDevicePixelRatio()},t.prototype.setMemoizer=function(e){this._memoizer=e},t.prototype.setDrawer=function(e){this._drawer=e},t.prototype.prerender=function(e){var s=e.pixelRatio,n=this._lastPixelRatio,r=n/s,o=n===0||r>1.25||r<.8;o&&(this._lastPixelRatio=s);var h=this._memoizer?this._memoizer.call(this):null,c=this._lastMemoKey!==h;if(o||c)return this._lastMemoKey=h,this._lastPixelRatio=s,typeof this._drawer=="function"&&this._drawer.call(this),!0},t.prototype.size=function(e,s,n){return this.setSize(e,s,n),this},t.prototype.context=function(e,s){return e===void 0&&(e="2d"),this.getContext(e,s)},t.prototype.canvas=function(e){return typeof e=="function"?e.call(this,this.getContext()):typeof e>"u"&&typeof this._drawer=="function"&&this._drawer.call(this),this},t})(Dt);var ht="click",se="touchstart mousedown",ne="touchmove mousemove",re=function(){function i(){}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return(this.x|0)+"x"+(this.y|0)},i}(),oe=function(){function i(){this.abs=new re}return i.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),he=function(){function i(){this.type="",this.x=0,this.y=0,this.timeStamp=-1,this.event=null,this.root=null,this.collected=null}return i.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},i}(),L=new oe,$=new he,ae=function(){function i(){var t=this;this.ratio=1,this.clickList=[],this.cancelList=[],this.handleStart=function(e){i.DEBUG&&console.debug&&console.debug("pointer-start",e.type),e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e),t.findTargets("click",t.clickList),t.findTargets("mousecancel",t.cancelList)},this.handleMove=function(e){e.preventDefault(),t.localPoint(e),t.dispatchEvent(e.type,e)},this.handleEnd=function(e){var s;e.preventDefault(),i.DEBUG&&console.debug&&console.debug("pointer-end",e.type),t.dispatchEvent(e.type,e),t.clickList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-click: ",e.type,(s=t.clickList)===null||s===void 0?void 0:s.length),t.dispatchEvent("click",e,t.clickList)),t.cancelList.length=0},this.handleCancel=function(e){var s;t.cancelList.length&&(i.DEBUG&&console.debug&&console.debug("pointer-cancel",e.type,(s=t.clickList)===null||s===void 0?void 0:s.length),t.dispatchEvent("mousecancel",e,t.cancelList)),t.clickList.length=0},this.visitStart=function(e,s){return!e._flag(s.type)},this.visitEnd=function(e,s){L.raw=s.event,L.type=s.type,L.timeStamp=s.timeStamp,L.abs.x=s.x,L.abs.y=s.y;var n=e.listeners(s.type);if(n){e.matrix().inverse().map(s,L);var r=e===s.root||e.attr("spy")||e.hitTest(L);if(r&&(s.collected&&s.collected.push(e),s.event)){for(var o=!1,h=0;h<n.length;h++)o=n[h].call(e,L)?!0:o;return o}}}}return i.prototype.mount=function(t,e){var s=this;return this.stage=t,this.elem=e,this.ratio=t.viewport().ratio||1,t.on("viewport",function(n){var r;s.ratio=(r=n.ratio)!==null&&r!==void 0?r:s.ratio}),e.addEventListener("touchstart",this.handleStart),e.addEventListener("touchend",this.handleEnd),e.addEventListener("touchmove",this.handleMove),e.addEventListener("touchcancel",this.handleCancel),e.addEventListener("mousedown",this.handleStart),e.addEventListener("mouseup",this.handleEnd),e.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this},i.prototype.unmount=function(){var t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this},i.prototype.localPoint=function(t){var e,s=this.elem,n,r;!((e=t.touches)===null||e===void 0)&&e.length?(n=t.touches[0].clientX,r=t.touches[0].clientY):(n=t.clientX,r=t.clientY);var o=s.getBoundingClientRect();n-=o.left,r-=o.top,n-=s.clientLeft|0,r-=s.clientTop|0,$.x=n*this.ratio,$.y=r*this.ratio},i.prototype.findTargets=function(t,e){var s=$;s.type=t,s.root=this.stage,s.event=null,s.collected=e,s.collected.length=0,this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},s)},i.prototype.dispatchEvent=function(t,e,s){var n=$;if(n.type=t,n.root=this.stage,n.event=e,n.timeStamp=Date.now(),n.collected=null,t!=="mousemove"&&t!=="touchmove"&&i.DEBUG&&console.debug&&console.debug("pointer:dispatchEvent",n,s==null?void 0:s.length),s){for(;s.length;){var r=s.shift();if(this.visitEnd(r,n))break}s.length=0}else this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},n)},i.DEBUG=!1,i}();function ce(i){i===void 0&&(i={});var t=new ue;return t.mount(i),t.pointer=new ae().mount(t,t.dom),t}var ue=function(i){X(t,i);function t(){var e=i.call(this)||this;return e.canvas=null,e.dom=null,e.context=null,e.pixelWidth=-1,e.pixelHeight=-1,e.pixelRatio=1,e.drawingWidth=0,e.drawingHeight=0,e.mounted=!1,e.paused=!1,e.sleep=!1,e.mount=function(s){if(s===void 0&&(s={}),typeof s.canvas=="string"?(e.canvas=document.getElementById(s.canvas),e.canvas||console.error("Canvas element not found: ",s.canvas)):s.canvas instanceof HTMLCanvasElement?e.canvas=s.canvas:s.canvas&&console.error("Unknown value for canvas:",s.canvas),e.canvas||(e.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!e.canvas){console.debug&&console.debug("Creating canvas element..."),e.canvas=document.createElement("canvas"),Object.assign(e.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});var n=document.body;n.insertBefore(e.canvas,n.firstChild)}e.dom=e.canvas,e.context=e.canvas.getContext("2d"),e.devicePixelRatio=window.devicePixelRatio||1,e.backingStoreRatio=e.context.webkitBackingStorePixelRatio||e.context.mozBackingStorePixelRatio||e.context.msBackingStorePixelRatio||e.context.oBackingStorePixelRatio||e.context.backingStorePixelRatio||1,e.pixelRatio=e.devicePixelRatio/e.backingStoreRatio,e.mounted=!0,e.requestFrame()},e.frameRequested=!1,e.requestFrame=function(){e.frameRequested||(e.frameRequested=!0,requestAnimationFrame(e.onFrame))},e._lastFrameTime=0,e._mo_touch=null,e.onFrame=function(s){if(e.frameRequested=!1,!(!e.mounted||!e.canvas||!e.context)){e.requestFrame();var n=e.canvas.clientWidth,r=e.canvas.clientHeight;(e.pixelWidth!==n||e.pixelHeight!==r)&&(e.pixelWidth=n,e.pixelHeight=r,e.drawingWidth=n*e.pixelRatio,e.drawingHeight=r*e.pixelRatio,(e.canvas.width!==e.drawingWidth||e.canvas.height!==e.drawingHeight)&&(e.canvas.width=e.drawingWidth,e.canvas.height=e.drawingHeight,console.debug&&console.debug("Resize: ["+e.drawingWidth+", "+e.drawingHeight+"] = "+e.pixelRatio+" x ["+e.pixelWidth+", "+e.pixelHeight+"]"),e.viewport({width:e.drawingWidth,height:e.drawingHeight,ratio:e.pixelRatio})));var o=e._lastFrameTime||s,h=s-o;if(!(!e.mounted||e.paused||e.sleep)){e._lastFrameTime=s,e.prerender();var c=e._tick(h,s,o);e._mo_touch!=e._ts_touch?(e._mo_touch=e._ts_touch,e.sleep=!1,e.drawingWidth>0&&e.drawingHeight>0&&(e.context.setTransform(1,0,0,1,0,0),e.context.clearRect(0,0,e.drawingWidth,e.drawingHeight),e.debugDrawAxis>0&&e.renderDebug(e.context),e.render(e.context))):c?e.sleep=!1:e.sleep=!0,D.fps=h?1e3/h:0}}},e.debugDrawAxis=0,e.label("Root"),e}return t.prototype.renderDebug=function(e){var s=typeof this.debugDrawAxis=="number"?this.debugDrawAxis:10,n=this.matrix();e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f);var r=3/n.a;e.beginPath(),e.moveTo(0,0),e.lineTo(0,.8*s),e.lineTo(-.2*s,.8*s),e.lineTo(0,s),e.lineTo(.2*s,.8*s),e.lineTo(0,.8*s),e.strokeStyle="rgba(93, 173, 226)",e.lineJoin="round",e.lineCap="round",e.lineWidth=r,e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(.8*s,0),e.lineTo(.8*s,-.2*s),e.lineTo(s,0),e.lineTo(.8*s,.2*s),e.lineTo(.8*s,0),e.strokeStyle="rgba(236, 112, 99)",e.lineJoin="round",e.lineCap="round",e.lineWidth=r,e.stroke()},t.prototype.resume=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this},t.prototype.pause=function(){return this.paused||this.publish("pause"),this.paused=!0,this},t.prototype.touch=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,i.prototype.touch.call(this)},t.prototype.unmount=function(){var e;return this.mounted=!1,(e=this.pointer)===null||e===void 0||e.unmount(),this},t.prototype.background=function(e){return this.dom&&(this.dom.style.backgroundColor=e),this},t.prototype.viewport=function(e,s,n){if(typeof e>"u")return Object.assign({},this._viewport);if(typeof e=="object"){var r=e;e=r.width,s=r.height,n=r.ratio}if(typeof e=="number"&&typeof s=="number"){this._viewport={width:e,height:s,ratio:typeof n=="number"?n:1},this.viewbox();var o=Object.assign({},this._viewport);this.visit({start:function(h){if(!h._flag("viewport"))return!0;h.publish("viewport",[o])}})}return this},t.prototype.viewbox=function(e,s,n){return typeof e=="number"&&typeof s=="number"?this._viewbox={width:e,height:s,mode:n}:typeof e=="object"&&e!==null&&(this._viewbox=ct({},e)),this.rescale(),this},t.prototype.camera=function(e){return this._camera=e,this.rescale(),this},t.prototype.rescale=function(){var e=this._viewbox,s=this._viewport,n=this._camera;if(s&&e){var r=s.width,o=s.height,h=Jt(e.mode)?e.mode:"in-pad",c=e.width,a=e.height;this.pin({width:c,height:a}),this.fit(r,o,h);var u=e.x||0,l=e.y||0,v=(n==null?void 0:n.a)||1,y=(n==null?void 0:n.d)||1,f=(n==null?void 0:n.e)||0,_=(n==null?void 0:n.f)||0,p=this.pin("scaleX"),x=this.pin("scaleY");this.pin("scaleX",p*v),this.pin("scaleY",x*y),this.pin("offsetX",f-u*p*v),this.pin("offsetY",_-l*x*y)}else s&&this.pin({width:s.width,height:s.height});return this},t.prototype.flipX=function(e){return this._pin._directionX=e?-1:1,this},t.prototype.flipY=function(e){return this._pin._directionY=e?-1:1,this},t}(B);function Xt(i,t){var e=new le;return e.frames(i).gotoFrame(0),t&&e.fps(t),e}var Yt=15,le=function(i){X(t,i);function t(){var e=i.call(this)||this;return e._texture=null,e._frames=[],e._time=-1,e._repeat=0,e._index=0,e._animTickLastTime=0,e._animTick=function(s,n,r){if(!(e._time<0||e._frames.length<=1)){var o=e._animTickLastTime!=r;if(e._animTickLastTime=n,o||(e._time+=s,e._time<e._ft))return!0;var h=e._time/e._ft|0;return e._time-=h*e._ft,e.moveFrame(h),e._repeat>0&&(e._repeat-=h)<=0?(e.stop(),e._callback&&e._callback(),!1):!0}},e.label("Anim"),e._fps=Yt,e._ft=1e3/e._fps,e.tick(e._animTick,!1),e}return t.prototype.renderTexture=function(e){this._texture&&this._texture.draw(e)},t.prototype.fps=function(e){return typeof e>"u"?this._fps:(this._fps=e>0?e:Yt,this._ft=1e3/this._fps,this)},t.prototype.setFrames=function(e){return this.frames(e)},t.prototype.frames=function(e){return this._index=0,this._frames=yt(e).array(),this.touch(),this},t.prototype.length=function(){return this._frames?this._frames.length:0},t.prototype.gotoFrame=function(e,s){return s===void 0&&(s=!1),this._index=I.wrap(e,this._frames.length)|0,s=s||!this._texture,this._texture=this._frames[this._index],s&&(this.pin("width",this._texture.getWidth()),this.pin("height",this._texture.getHeight())),this.touch(),this},t.prototype.moveFrame=function(e){return this.gotoFrame(this._index+e)},t.prototype.repeat=function(e,s){return this._repeat=e*this._frames.length-1,this._callback=s,this.play(),this},t.prototype.play=function(e){return typeof e<"u"?(this.gotoFrame(e),this._time=0):this._time<0&&(this._time=0),this.touch(),this},t.prototype.stop=function(e){return this._time=-1,typeof e<"u"&&this.gotoFrame(e),this},t}(B);function A(i){return new de().frames(i)}var de=function(i){X(t,i);function t(){var e=i.call(this)||this;return e._textures=[],e.label("Monotype"),e}return t.prototype.renderTexture=function(e){if(!(!this._textures||!this._textures.length))for(var s=0,n=this._textures.length;s<n;s++)this._textures[s].draw(e)},t.prototype.setFont=function(e){return this.frames(e)},t.prototype.frames=function(e){if(this._textures=[],typeof e=="string"){var s=yt(e);this._font=function(n){return s.one(n)}}else typeof e=="object"?this._font=function(n){return e[n]}:typeof e=="function"&&(this._font=e);return this},t.prototype.setValue=function(e){return this.value(e)},t.prototype.value=function(e){if(typeof e>"u")return this._value;if(this._value===e)return this;this._value=e,e===null?e="":typeof e!="string"&&!Array.isArray(e)&&(e=e.toString()),this._spacing=this._spacing||0;for(var s=0,n=0,r=0;r<e.length;r++){var o=e[r],h=this._textures[r]=this._font(typeof o=="string"?o:o+"");s+=r>0?this._spacing:0,h.setDestinationCoordinate(s,0),s=s+h.getWidth(),n=Math.max(n,h.getHeight())}return this.pin("width",s),this.pin("height",n),this._textures.length=e.length,this},t}(B);const fe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let U=(i=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(i|=0));for(;i--;)t+=fe[e[i]&63];return t};class pe{constructor(t){this.key="coin-"+U(6),this.type="coin",this.position={x:0,y:0},this.radius=6,this.collected=!1,this.value=t}}class _e{constructor(t){this.key="enemy-"+U(6),this.type="enemy",this.position={x:0,y:0},this.radius=5,this.push=1,this.velocity={x:0,y:0},this.weak=!1,this.collected=!1,this.name=t}}class ge{constructor(){this.key="power-"+U(6),this.type="power",this.position={x:0,y:0},this.radius=5,this.pull=.1,this.collected=!1}}class ve{constructor(){this.key="bubble-"+U(6),this.type="bubble",this.position={x:0,y:0},this.radius=1,this.velocity={x:0,y:0},this.pull=1,this.collected=!1}}class ye{constructor(){this.key="player-"+U(6),this.type="player",this.x=0,this.y=0,this.radius=6,this.name="player",this.dead=!1,this.upgrade=t=>{this.power=500+(t.power??0)*250,this.oxygen=8e-4*(1-(t.oxygen??0)/8),this.speed=.2+(t.speed??0)*.02,this.pull=t.pull??0,this.push=t.push??0,this.slow=1/((t.slow??0)*.2+1)},this.upgrade({})}}class xe extends m{constructor(t){super(),this.handleSetScreen=e=>{this.page&&this.unuse(this.page),this.page=this.pages[e.name],this.page?(this.setContext(s=>{s.page=e}),this.use(this.page)):console.log("Unknown page",e.name)},this.pages=t,this.on("page-set",this.handleSetScreen)}}const me={width:120,height:240,xMax:.47*120,xMin:-.47*120,speed:110,acceleration:8e-4,itemSpace:20,bubbleSpace:6,notch:0};class we extends m{constructor(){super(),this.handleActivate=()=>{this.context.config=me},this.on("activate",this.handleActivate)}}const F=["pull","speed","push","power","oxygen","slow"];class be{constructor(){this.coins=0,this.dist=0}}class ke{constructor(){this.power=0,this.oxygen=0,this.speed=0,this.pull=0,this.push=0,this.slow=0,this.bookmarks=0}}class Me{constructor(){this.upgrades=new ke,this.bookmarks=[],this.stats=new be}}class Te{constructor(){this.objects=[],this.stats={bubbles:0,power:0,coins:{1:0,2:0,5:0,10:0,20:0,50:0,100:0,1e3:0,1e4:0},enemies:{shark:0,octopus:0}}}}const C={coin:(i=0)=>{let t;return i<1e4?t=i+"":i<1e6?t=(i/100|0)/10+"k":t=(i/1e4|0)/100+"M","$"+t},k:(i=0)=>{i=i/10|0;let t;return i<1e4?t=i+"":i<1e6?t=(i/100|0)/10+"k":t=(i/1e4|0)/100+"M",">"+t}},pt=(i,t)=>Math.pow(10,t+2);class Se extends m{constructor(){super(),this.handleInsertBookmark=({dist:t,index:e})=>{const s=this.context.user.bookmarks,n=this.context.user.upgrades.bookmarks;let r=!1;for(;e<s.length&&s[e]<=t;)s.splice(e,1),r=!0;r?s.splice(e,0,t):e>=s.length&&s.length<=n+1&&s.push(t)},this.handleUserUpgrade=t=>{if("name"in t){const e=pt(t.name,this.context.user.upgrades[t.name]);if(!(typeof this.context.user.upgrades[t.name]=="number")){console.log("invalid upgrade name",t.name);return}if(!(e>0&&e<=this.context.user.stats.coins)){console.log("cannot afford upgrade",t.name,e,this.context.user.stats.coins);return}this.context.user.stats.coins-=e,this.context.user.upgrades[t.name]+=1,this.emit("data-save"),this.emit("data-load")}},this.on("user-upgrade",this.handleUserUpgrade),this.on("insert-bookmark",this.handleInsertBookmark)}}class Ae extends m{constructor(){super(),this.handleActivate=()=>{this.setup();const t=this.context.stage;t.empty(),t.append(this.page),t.background("#000"),this.page.show(),this.page.pin("alpha",0),this.page.tween(400).pin("alpha",1),this.handleViewport(),this.update()},this.handleClickBookmark=t=>{t==this.context.user.upgrades.bookmarks?this.emit("user-upgrade",{name:"bookmarks"}):t<this.context.user.bookmarks.length&&this.emit("page-set",{name:"play-page",bookmark:t})},this.handleClickUpgrade=t=>{this.emit("user-upgrade",{name:t})},this.handleViewport=()=>{this.page.pin({width:this.page.parent().pin("width"),height:this.page.parent().pin("height")}),this.background.pin({scaleMode:"out",scaleWidth:this.page.pin("width"),scaleHeight:this.page.pin("height")})},this.update=()=>{const t=this.context.user;this.dist.value(C.k(t.stats.dist)),this.coins.value(C.coin(t.stats.coins));for(let e=0;e<this.bookmarks.length;e++){const s=this.bookmarks[e],n=e==0?0:t.bookmarks[e-1],r=pt("bookmark",e-1);e<=t.upgrades.bookmarks?s.setDistance(n):e==t.upgrades.bookmarks+1?(t.bookmarks.length===e&&s.setDistance(t.stats.dist),s.setPrice(r,r<=t.stats.coins)):s.setPrice(r,!1)}for(let e=0;e<F.length;e++){const s=F[e],n=pt("bookmark",t.upgrades[s]??0);this.upgrades[s].setPrice(t.upgrades[s]??0,n,n<=t.stats.coins)}},this.on("activate",this.handleActivate),this.on("data-save",this.update),this.on("data-load",this.update)}setup(){if(this.page)return;this.page=W(),this.page.pin({align:.5}),this.page.on("viewport",this.handleViewport),this.background=S("homebg"),this.background.appendTo(this.page),this.background.pin("align",.5);const t=ie(.5);t.appendTo(this.page),t.pin("align",.5),t.spacing(4);const e=S("logo");e.appendTo(t),e.pin({scale:1.4});const s=A("di");s.value("?"),s.pin({alignX:1,alignY:0,handleX:1,handleY:1}),s.appendTo(e),s.on(ht,()=>{this.emit("page-set",{name:"help-page"})}),this.dist=A("di"),this.dist.appendTo(e),this.dist.pin({alignX:.5,alignY:1,offsetX:-3,offsetY:-3,handleX:1,scale:.65}),this.coins=A("di"),this.coins.appendTo(e),this.coins.pin({alignX:.5,alignY:1,offsetX:3,offsetY:-3,handleX:0,scale:.65});const n=K(0);n.appendTo(t),n.spacing(4);const r=K(0);r.appendTo(t),r.spacing(4);const o=K(0);o.appendTo(t),o.spacing(4);const h=K(0);h.appendTo(t),h.spacing(4),this.bookmarks=[];for(let c=0;c<6;c++){const a=c-1,u=new Xe;u.appendTo(c<3?n:r),u.on(ht,()=>this.handleClickBookmark(a)),this.bookmarks.push(u)}this.upgrades={};for(let c=0;c<6;c++){const a=F[c],u=new Ye(a);u.appendTo(c<3?o:h),u.on(ht,()=>this.handleClickUpgrade(a)),this.upgrades[a]=u}this.update()}}class Xe extends rt{constructor(){super(),this.texture("play"),this.pin("alpha",.9),this.distanceText=A("d"),this.distanceText.appendTo(this),this.distanceText.pin({alignY:.5,alignX:.45,handle:.5,scale:.9}),this.priceTag=A("d"),this.priceTag.pin({align:1,offsetX:-1.6,offsetY:-1.4,alpha:.8,scale:.6}),this.priceTag.appendTo(this)}setDistance(t){this.priceTag.hide(),this.distanceText.value(typeof t=="number"?C.k(t):""),this.distanceText.show(),this.distanceText.alpha(1)}setPrice(t,e){this.priceTag.value(C.coin(t)),this.priceTag.show(),this.priceTag.alpha(e?1:.5),this.distanceText.alpha(.5)}}class Ye extends rt{constructor(t){super(),this.texture("option"),this.upgradeImage=S("up_"+t),this.upgradeImage.pin("align",.5),this.upgradeImage.appendTo(this),this.priceTag=A("d"),this.priceTag.pin({align:1,offsetX:-1.6,offsetY:-1.4,alpha:.5,scale:.6}),this.priceTag.appendTo(this),this.levelTag=A("up"),this.levelTag.pin({alignX:0,alignY:0,offsetX:1.6,offsetY:1.4,alpha:1,scale:.6}),this.levelTag.appendTo(this)}setPrice(t,e,s){this.pin("alpha",.9),this.priceTag.value(C.coin(e)),t<=6&&this.levelTag.value(t),this.upgradeImage.alpha(s?1:.7),this.priceTag.alpha(s?1:.5)}}const j=[];class d{static lengthOf(t,e){return Math.sqrt(t*t+e*e)}static randomNumber(t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),t==e?t:Math.random()*(e-t)+t}static wrapNumber(t,e,s){return typeof e>"u"?(s=1,e=0):typeof s>"u"&&(s=e,e=0),s>e?(t=(t-e)%(s-e),t+(t<0?s:e)):(t=(t-s)%(e-s),t+(t<=0?e:s))}static spinWheel(t,e){const s=t.length;let n=0;for(let h=0;h<s;h++){const c=t[h];typeof c.weight=="function"?j[h]=c.weight(e):typeof c.weight=="number"?j[h]=c.weight:j[h]=1,n+=j[h]}let r=Math.random()*n,o=null;for(let h=0;h<s&&(o=t[h].value,r-=j[h],!(r<0));h++);return o}}class Ee extends m{constructor(){super(),this.handleLevelStart=()=>{this.queueNext()},this.handleInsertBubble=t=>{--this.next<=0&&(this.insertPower(t.position.x,t.position.y),this.queueNext())},this.insertPower=(t,e)=>{const s=new ge;s.position.x=t,s.position.y=e,this.emit("insert-power",s)},this.on("level-start",this.handleLevelStart),this.on("insert-bubble",this.handleInsertBubble)}queueNext(){this.next=d.randomNumber(50,200)}}const w=class w{};w.line=(t,e)=>{const s=d.randomNumber(40,50),n=d.randomNumber(t.xMin,t.xMax),r=t.y;let o=0;for(let h=0;h<s;h++)o++,e(n,r+h*t.space);return o},w.slope=(t,e)=>{const s=d.randomNumber(20,40)|0,n=J(t.xMin,t.xMax,d.randomNumber(.2,.7)),r=t.y;let o=0;for(let h=0;h<s;h++)o++,e(n.from+h*n.range/s,r+h*t.space);return o},w.wave=(t,e)=>{const s=d.randomNumber(40,60),n=t.space/d.randomNumber(10,30),r=d.randomNumber(10,30),o=d.randomNumber(t.xMin+r,t.xMax-r),h=t.y;let c=0;for(let a=0;a<s;a++)c++,e(o+r*Math.sin(a*n),h+a*t.space);return c},w.stairs=(t,e)=>{const s=d.randomNumber(3,6)|0,n=d.randomNumber(5,15)|0,r=s*n,o=J(t.xMin,t.xMax,d.randomNumber(.3,.7)),h=t.y,c=o.range/s;let a=0;for(let u=0;u<r;u++)a++,e(o.from+(u*o.range/r/c|0)*c,h+u*t.space);return a},w.saw=(t,e)=>{const s=d.randomNumber(2,6)|0,n=d.randomNumber(7,13)|0,r=s*n,o=J(t.xMin,t.xMax,d.randomNumber(.1,.6)),h=t.y,c=o.range;let a=0;for(let u=0;u<r;u++)a++,e(o.from+(-u*o.range/n/c|0)*c+u*o.range/n,h+u*t.space);return a},w.wave2d=(t,e)=>{const s=d.randomNumber(40,60),n=t.space/d.randomNumber(10,40),r=d.randomNumber(10,30),o=t.space/d.randomNumber(10,40),h=d.randomNumber(10,30),c=d.randomNumber(t.xMin+r,t.xMax-r),a=t.y;let u=0;for(let l=0;l<s;l++)u++,e(c+r*Math.sin(l*n),a+l*t.space+h*Math.cos(l*o));return u},w.zigzag=(t,e)=>{const s=d.randomNumber(40,60),n=t.space/d.randomNumber(10,40),r=d.randomNumber(10,30),o=d.randomNumber(t.xMin+r,t.xMax-r),h=t.y;let c=0;for(let a=0;a<s;a++)c++,e(o+r*_t(a*n),h+a*t.space);return c},w.zigzag2d=(t,e)=>{const s=d.randomNumber(40,60),n=t.space/d.randomNumber(10,40),r=d.randomNumber(10,30),o=t.space/d.randomNumber(10,40),h=d.randomNumber(10,30),c=d.randomNumber(t.xMin+r,t.xMax-r),a=t.y;let u=0;for(let l=0;l<s;l++)u++,e(c+r*_t(l*n),a+l*t.space+h*Ne(l*o));return u},w.square=(t,e)=>{const s=d.randomNumber(3,8),n=s,r=d.randomNumber(t.xMin,t.xMax-n*t.space),o=t.y;let h=0;for(let c=0;c<s;c++)for(let a=0;a<n;a++)h++,e(r+a*t.space,o+c*t.space);return h},w.spray=(t,e)=>{const s=d.randomNumber(40,60),n=J(t.xMin,t.xMax,.2+t.hardness),r=t.y;let o=0;for(let h=0;h<s;h++)o++,e(d.randomNumber(n.from,n.to),r+h*t.space);return o},w.spiral=(t,e)=>{const s=d.randomNumber(40,60),n=(1-Math.sqrt(5))/2,r=d.randomNumber(.5,.5+t.hardness/2),o=t.y+r*s+10;let h=0;for(let c=10;c<s+10;c++)h++,e(r*c*Math.cos(c*n*Math.PI*2),o+r*c*Math.sin(c*n*Math.PI*2));return h};let k=w;function _t(i){return i=d.wrapNumber(i,-Math.PI,Math.PI)/Math.PI*2,i>1?i=2-i:i<-1&&(i=-2-i),i}function Ne(i){return _t(i+Math.PI/2)}function J(i,t,e){let s=e*(t-i);const n=d.randomNumber(i+s/2,t-s/2);return s*=Math.random()>=.5?1:-1,{from:n-s/2,to:n+s/2,range:s,center:n}}class Be extends m{constructor(){super(),this.handleLevelStart=()=>{this.next=this.context.level.dist},this.handleLevelStep=()=>{for(;this.next<=this.context.level.dist;){const t=d.spinWheel(Pe,{dist:this.context.level.dist});if(!t)continue;const e={xMin:this.context.config.xMin,xMax:this.context.config.xMax,y:this.next+this.context.config.height,space:this.context.config.bubbleSpace,hardness:this.context.level.dist/1e5},s=t(e,this.insertBubble);this.queueNext(s)}},this.queueNext=t=>{const e=d.randomNumber(1,1.5)+this.context.level.dist/1e4;this.next+=t*e*this.context.config.bubbleSpace},this.insertBubble=(t,e,s=d.randomNumber(0,2),n=d.randomNumber(0,2))=>{const r=new ve;r.position.x=t,r.position.y=e,r.velocity.x=s,r.velocity.y=n,this.emit("insert-bubble",r)},this.handleEnemyCollected=t=>{if((t==null?void 0:t.type)!=="enemy")return;const e=t.position.x,s=t.position.y,n=d.randomNumber(8,14)|0;for(let r=0;r<n;r++){const o=d.randomNumber(10,16),h=r*2/n*Math.PI,c=e+o*Math.cos(h),a=s+o*Math.sin(h),u=Math.cos(h)*8*d.randomNumber(1,1.2),l=Math.sin(h)*8*d.randomNumber(1,1);this.insertBubble(c,a,u,l)}},this.on("level-start",this.handleLevelStart),this.on("level-step",this.handleLevelStep),this.on("enemy-collected",this.handleEnemyCollected)}}const Pe=[{value:k.line,weight:i=>1},{value:k.slope,weight:i=>1},{value:k.stairs,weight:i=>1},{value:k.saw,weight:i=>1},{value:k.wave,weight:i=>1},{value:k.wave2d,weight:i=>1},{value:k.zigzag,weight:i=>1},{value:k.square,weight:i=>1},{value:k.spray,weight:i=>1},{value:k.spiral,weight:i=>1}];class Le extends m{constructor(){super(),this.handleLevelStart=()=>{this.next=this.context.level.dist,this.queueNext()},this.handleLevelStep=()=>{for(;this.next<=this.context.level.dist;){const t=d.spinWheel(Ce,{dist:this.context.level.dist});if(!t)continue;const e=d.randomNumber(this.context.config.xMin,this.context.config.xMax),s=this.next+this.context.config.height;return this.insertCoin(t,e,s),this.queueNext(),!0}},this.insertCoin=(t,e,s)=>{const n=new pe(t);n.position.x=e,n.position.y=s,this.emit("insert-coin",n)},this.on("level-start",this.handleLevelStart),this.on("level-step",this.handleLevelStep)}queueNext(){this.next+=d.randomNumber(100,400)}}const Ce=[{value:1,weight:()=>1},{value:2,weight:i=>i.dist>1e3?1:0},{value:5,weight:i=>i.dist>2e3?2:0},{value:10,weight:i=>i.dist>5e3?4:0},{value:20,weight:i=>i.dist>1e4?8:0},{value:50,weight:i=>i.dist>2e4?16:0},{value:100,weight:i=>i.dist>5e4?32:0},{value:1e3,weight:i=>i.dist>5e4?4*i.dist/1e5:0},{value:1e4,weight:i=>i.dist>7e4?2*i.dist/1e5:0},{value:1e5,weight:i=>i.dist>1e5?i.dist/1e5:0},{value:1e5,weight:i=>i.dist>15e4?.5*i.dist/1e5:0}];class Re extends m{constructor(){super(),this.handleLevelStart=()=>{this.next=this.context.level.dist,this.queueNext()},this.handleLevelStep=()=>{for(;this.next<=this.context.level.dist;){const t=d.spinWheel(De);if(!t)continue;const e={dist:this.next+this.context.config.height,speed:this.context.level.speed,width:this.context.config.width};t(e,this.insertEnemy),this.queueNext()}},this.insertEnemy=(t,e,s,n=0,r=0)=>{const o=new _e(t);o.position.x=e,o.position.y=s,o.velocity.x=n,o.velocity.y=r,this.emit("insert-enemy",o)},this.on("level-start",this.handleLevelStart),this.on("level-step",this.handleLevelStep)}queueNext(){this.next+=d.randomNumber(20,200)}}const De=[{value:(i,t)=>{const e=d.randomNumber(-.5,.5)*i.width;t("octopus",e,i.dist)}},{value:(i,t)=>{const e=Math.random()>=.5?1:-1,s=-e*i.speed*d.randomNumber(.35,.7),n=0,r=e*(i.width/2)-.4*s,o=i.dist+.4*i.speed;t("shark",r,o,s,n)}}];class Ie extends m{constructor(){super(),this.handleUserPointer=({x:t,y:e})=>{if(!this.context.level.player.dead)return this.context.level.cursor.x=t,this.context.level.cursor.y=e,this.context.level.cursor.fresh=!0,this.context.level.speed>0},this.handleUserMove=({x:t,y:e})=>{if(!this.context.level.player.dead)return this.context.level.cursor.x+=t*t*this.context.config.width*(t<0?-1:1)*3,this.context.level.cursor.y+=e*e*this.context.config.height*(e<0?-1:1)*3,this.context.level.cursor.fresh=!0,this.context.level.speed>0},this.on("user-pointer",this.handleUserPointer)}}class We extends m{constructor(){super(),this.inserted=[],this.deleted=new Set,this.startBookmark=-1,this.startDist=0,this.handlePlayerDie=()=>{this.context.level.player.dead||this.endLevel()},this.endLevel=()=>{const{user:t,level:e}=this.context;e.player.dead=!0,e.speed=0,this.emit("insert-bookmark",{dist:e.dist,index:this.startBookmark+1}),e.dist>t.stats.dist&&(t.stats.dist=e.dist),t.stats.coins+=e.coins,this.emit("data-save"),this.emit("level-end")},this.handleInsert=t=>{this.inserted.push(t)},this.handleDelete=t=>{this.deleted.add(t)},this.handleTick=t=>{t=Math.min(t,100);const e=t/1e3,s=this.context.level,n=s.player;for(let c=this.inserted.length-1;c>=0;c--){const a=this.inserted[c];a.position.y+(a.radius||0)<s.dist+this.context.config.height&&(this.inserted.splice(c,1),s.objects.push(a))}for(let c=s.objects.length-1;c>=0;c--){const a=s.objects[c];if(s.power>0&&a.type==="enemy"&&(a.weak=!0),a.position.y-(a.radius||0)<s.dist){s.objects.splice(c,1);continue}if("velocity"in a&&(a.position.x+=e*a.velocity.x,a.position.y+=e*a.velocity.y),n.dead)continue;let u=a.position.x-n.x,l=a.position.y-n.y,v=d.lengthOf(u,l);if(n.pull&&"pull"in a){const f=n.pull*a.pull*5e3/v/v/v,_=Math.min(1,f*e);a.position.x-=u*_,a.position.y-=l*_}if(n.push&&"push"in a&&"weak"in a&&!a.weak){const y=n.push*a.push,f=y*.3/(1+Math.pow(1.1,v-10*(y+1))),_=Math.min(1,f*e);a.position.x+=u*_,a.position.y+=l*_}u=a.position.x-n.x,l=a.position.y-n.y,v=d.lengthOf(u,l),v<a.radius+n.radius&&this.emit("physics-collide",{player:n,obj:a})}for(let c=s.objects.length-1;c>=0;c--){const a=s.objects[c];this.deleted.has(a)&&(this.deleted.delete(a),s.objects.splice(c,1))}if(n.dead)return;const r=e*(s.speed+s.dist*this.context.config.acceleration);s.dist+=r,s.power=Math.max(0,s.power-r),s.oxygen=Math.max(0,s.oxygen-r*n.oxygen);let o=n.x,h=n.y;if(s.cursor.fresh){const c=s.cursor.x-o,a=s.cursor.y-h;let u=d.lengthOf(c,a);u<.1&&(s.cursor.fresh=!1),u=Math.max(1,u/s.cursor.speed/t),o+=c/u,h+=a/u}s.cursor.y+=r,h+=r,n.x=o,n.y=h,this.emit("level-step"),!n.dead&&s.oxygen<=0&&this.emit("player-die")},this.handleCollide=({player:t,obj:e})=>{e.type==="bubble"?this.collideBubble(t,e):e.type==="enemy"?this.collideEnemy(t,e):e.type==="power"?this.collidePower(t,e):e.type==="coin"&&this.collideCoin(t,e)},this.collideEnemy=(t,e)=>{t.dead||e.collected||(e.weak?(e.push=0,e.collected=!0,e.velocity.x=0,e.velocity.y=0,this.context.level.stats.enemies[e.name]+=1,this.emit("enemy-collected",e)):this.emit("player-die"))},this.collideBubble=(t,e)=>{this.context.level.oxygen=Math.min(1.5,this.context.level.oxygen+.01),e.collected=!0,this.context.level.stats.bubbles+=1,this.emit("delete-entity",e)},this.collideCoin=(t,e)=>{this.context.level.coins+=e.value,e.collected=!0,this.context.level.stats.coins[e.value]+=1,this.emit("delete-entity",e)},this.collidePower=(t,e)=>{this.context.level.power=Math.max(this.context.level.player.power,this.context.level.power),e.collected=!0,this.context.level.stats.power+=1,this.emit("delete-entity",e)},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate),this.on("terminal-tick",this.handleTick),this.on("insert-bubble",this.handleInsert),this.on("insert-enemy",this.handleInsert),this.on("insert-coin",this.handleInsert),this.on("insert-power",this.handleInsert),this.on("delete-entity",this.handleDelete),this.on("physics-collide",this.handleCollide),this.on("player-die",this.handlePlayerDie),this.use(new Ie),this.use(new Be),this.use(new Le),this.use(new Re),this.use(new Ee)}handleActivate(){this.startLevel()}startLevel(){this.context.level=new Te;const t=this.context.page.bookmark,e=this.context.user.bookmarks[t];this.startDist=e>0?e:0,this.startBookmark=e>0?t:-1,this.context.level.coins=0,this.context.level.power=0,this.context.level.oxygen=1,this.context.level.speed=this.context.config.speed,this.context.level.dist=this.startDist;const s=0,n=this.context.config.height/5+this.context.level.dist;this.context.level.player=new ye,this.context.level.player.upgrade(this.context.user.upgrades),this.context.level.player.x=s,this.context.level.player.y=n,this.context.level.cursor={x:s,y:n,speed:this.context.level.player.speed},this.emit("level-start")}handleDeactivate(){this.context.level=null}}const Ot={1:.7*1,2:.75*1,5:.8*1,10:.9*1,20:.95*1,50:1*1,100:1.1*1};class Oe extends m{constructor(){super(),this.handleActivate=()=>{var e;this.setup();const t=this.context.stage;t.empty(),t.append(this.page),(e=t.dom)!=null&&e.style&&(t.dom.style.cursor="none"),t.background(He()),this.handleViewport(),this.page.pin("alpha",0),this.page.show(),this.page.tween(200).pin("alpha",1)},this.handleDeactivate=()=>{var e;const t=this.context.stage;(e=t.dom)!=null&&e.style&&(t.dom.style.cursor=""),this.page.remove()},this.handleLevelEnd=()=>{this.page.tween(1e3).hide().done(()=>{this.emit("page-set",{name:"home-page"})})},this.handleViewport=()=>{this.page.pin({width:this.page.parent().pin("width"),height:this.page.parent().pin("height")}),this.bg.pin({scaleMode:"out",scaleWidth:this.page.pin("width"),scaleHeight:this.page.pin("height")});const t=this.context.config.notch/this.page.pin("scaleX")/this.page.parent().pin("scaleX");this.top.pin({width:this.page.pin("width"),height:t,offsetY:-t})},this.handlePointerMove=t=>{this.emit("user-pointer",t)},this.handlePointerDown=t=>{this.emit("user-pointer",t)},this.handleTick=t=>{this.emit("terminal-tick",t);const e=this.context.level;this.coins.value(C.coin(e.coins)),this.oxygen.setValue(e.oxygen*25,e.oxygen<.35),this.powerup.setValue(e.power/30),this.dist.value(C.k(e.dist)),this.viewbox.pin("offsetY",e.dist),this.cursor.offset(e.cursor),this.binder.data([e.player,...e.objects])},this.playerDriver=R.create({filter:t=>t.type==="player",enter:t=>{const e=Xt(t.name+"_alive");return e.pin("handle",.5),e.appendTo(this.player),e.scale(1,-1),e.play(),{ui:e,memo:tt.init()}},update:(t,{ui:e,memo:s})=>{s.update(t.dead)&&(e.frames(t.name+(t.dead?"_dead":"_alive")),e.repeat(1),e.scale(1,-1)),e.offset(t)},exit:(t,{ui:e,memo:s})=>{e.remove()}}),this.enemyDriver=R.create({filter:t=>t.type==="enemy",enter:t=>{const e=Xt(t.name+"_alive");e.play(),e.pin("handle",.5),e.appendTo(this.items);const s=t.velocity&&t.velocity.x>0;return e.scale(s?-1:1,-1),{ui:e,memo:tt.init()}},exit:(t,{ui:e,memo:s})=>{e.remove()},update:(t,{ui:e,memo:s})=>{e.offset(t.position),s.update(t.weak,t.collected)&&(t.collected?(e.frames(t.name+"_dead"),e.gotoFrame(0),e.pin({alpha:.8,rotation:0})):t.weak?(e.frames(t.name+"_weak"),e.gotoFrame(0)):(e.frames(t.name+"_alive"),e.gotoFrame(0)))}}),this.powerDriver=R.create({filter:t=>t.type==="power",enter:t=>{const e=S("power");return e.pin("handle",.5),e.appendTo(this.items),e},exit:(t,e)=>{t.collected?e.tween(100).scale(5,5).alpha(.2).tween(800).scale(100,100).alpha(0).remove():e.remove()},update:(t,e)=>{e.offset(t.position)}}),this.coinDriver=R.create({filter:t=>t.type==="coin",enter:t=>{const e=Ot[t.value]||1,s=S("coin_"+t.value);return s.pin("handle",.5),s.appendTo(this.items),s.scale(e,-e),s},update:(t,e)=>{e.offset(t.position)},exit:(t,e)=>{if(t.collected){this.lastCoin.setCoin(t.value,1e3);const s=e.pin("offsetX"),n=e.pin("offsetY"),r=this.context.level.speed;e.tween(200).offset(s,n+r*.2).scale(2,-2).tween(200).offset(s,n+r*.4).scale(3,3).alpha(0).remove()}else e.remove()}}),this.bubbleDriver=R.create({filter:t=>t.type==="bubble",enter:t=>{const e=S("bubble");return e.pin("handle",.5),e.appendTo(this.bubbles),e.show(),e},update:(t,e)=>{e.offset(t.position)},exit:(t,e)=>{e.remove()}}),this.binder=vt.create({key:t=>t.key,drivers:[this.playerDriver,this.enemyDriver,this.powerDriver,this.coinDriver,this.bubbleDriver]}),this.use(new We),this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate),this.on("level-end",this.handleLevelEnd)}setup(){this.page=W(),this.page.pin({align:.5}),this.page.on("viewport",this.handleViewport),this.page.tick(this.handleTick,!0),this.bg=S("playbg"),this.bg.appendTo(this.page),this.bg.pin("align",.5),this.border=S("border"),this.border.stretch(),this.border.appendTo(this.page),this.border.pin({width:this.context.config.width,height:this.context.config.height,align:.5,alpha:.5}),this.top=S("shadow"),this.top.stretch(),this.top.appendTo(this.page),this.viewbox=W(),this.viewbox.appendTo(this.page),this.viewbox.attr("spy",!0),this.viewbox.pin({width:this.context.config.width,height:this.context.config.height,alignX:.5,alignY:.5,handleX:0,scaleY:-1}),this.oxygen=new Et("oxygen"),this.oxygen.appendTo(this.page),this.oxygen.pin({alignX:1,alignY:0,offsetX:-3,offsetY:2}),this.powerup=new Et("powerup"),this.powerup.appendTo(this.page),this.powerup.pin({alignX:1,alignY:0,offsetX:-3,offsetY:8}),this.dist=A("d"),this.dist.appendTo(this.page),this.dist.pin({alignX:0,alignY:0,offsetX:3,offsetY:11,handleX:0}),this.coins=A("d"),this.coins.appendTo(this.page),this.coins.pin({alignX:0,alignY:0,offsetX:3,offsetY:3}),this.lastCoin=new Fe,this.lastCoin.appendTo(this.page),this.lastCoin.pin({alignX:.5,alignY:0,offsetX:10,offsetY:2}),this.lastCoin.hide(),this.cursor=S("cursor"),this.cursor.pin("handle",.5),this.cursor.appendTo(this.viewbox),this.bubbles=W().appendTo(this.viewbox),this.items=W().appendTo(this.viewbox),this.player=W().appendTo(this.viewbox),this.viewbox.on(ne,this.handlePointerMove),this.viewbox.on(se,this.handlePointerDown)}}const He=je(["#f2f2f2","#e1e1e1","#ff5a82","#ff5555","#db4cf4","#ff4edc","#7d7de8","#a163ff","#5ba2dd","#00b2de","#56dc8b","#62d962","#a0f667","#d6ff36","#ecff24","#fffe34","#ffda3e","#ffb843"]);function je(i){for(let e=i.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1)),n=i[e];i[e]=i[s],i[s]=n}let t=0;return()=>i[t++%i.length]}class Et extends rt{constructor(t){super(),this.warn=!1,this.texture(t),this.stretch(),this.tick((e,s)=>{this.alpha(this.warn?Math.sin(s/100)*.5+.5:1)})}setValue(t,e=!1){this.warn=e,this.pin("width",Math.max(0,t)+5),this.visible(t>0)}}class Fe extends B{constructor(){super(),this.setCoin=(t,e)=>{const s=Ot[t];this.coinImage.texture("coin_"+t).pin("scale",s||1),this.coinValue.value(C.coin(t)).visible(t>100),this.show(),clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.hide(),e)},this.column(.5),this.coinImage=S(),this.coinImage.appendTo(this),this.coinValue=A("d"),this.coinValue.pin("scale",.8),this.coinValue.appendTo(this),this.hide()}}class ze extends m{constructor(){super()}}class Ue extends m{constructor(){super(),this.closeButton=null,this.contentModal=null,this.handleActivate=()=>{this.setup(),this.contentModal.showModal()},this.handleDeactivate=()=>{this.contentModal.close()},this.handleCloseModal=()=>{this.emit("page-set",{name:"home-page"})},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}setup(){if(!this.contentModal){if(this.contentModal=document.querySelector("dialog#help-content"),!this.contentModal){console.log("help-content dialog element not found");return}this.closeButton=this.closeButton??document.createElement("button"),this.closeButton.ariaLabel="close",this.closeButton.textContent="✕",this.contentModal.appendChild(this.closeButton),this.closeButton.addEventListener("click",this.handleCloseModal)}}}class Ve extends m{constructor(){super(),this.handleActivate=()=>{const t=ce();t.on("viewport",e=>{t.pin({width:this.context.config.width,height:this.context.config.height,scaleMode:"in-pad",scaleWidth:e.width,scaleHeight:e.height-this.context.config.notch,offsetY:this.context.config.notch})}),this.setContext(e=>{e.stage=t})},this.handleStageReady=()=>{this.emit("page-set",{name:"home-page"})},this.on("activate",this.handleActivate),this.on("stage-ready",this.handleStageReady),this.use(new xe({"home-page":new Ae,"play-page":new Oe,"end-page":new ze,"help-page":new Ue}))}}const qe="/polymatic-example-ocean/assets/main-C3pdLhG_.png",Ge={image:{src:qe,ratio:8},ppu:16,textures:{playbg:{x:12.1,y:4.1,width:.8,height:.8},homebg:{x:13.1,y:4.1,width:.8,height:.8},shadow:{x:15.35,y:4.25,width:.3,height:.1},option:{x:14.25,y:2.25,width:1.5,height:1.5},play:{x:12.25,y:2.25,width:1.5,height:1.5},logo:{x:12,y:0,width:4,height:1.8},coin_1:{x:0,y:1,width:1,height:1},coin_2:{x:1,y:1,width:1,height:1},coin_5:{x:2,y:1,width:1,height:1},coin_10:{x:3,y:1,width:1,height:1},coin_20:{x:4,y:1,width:1,height:1},coin_50:{x:5,y:1,width:1,height:1},coin_100:{x:6,y:1,width:1,height:1},coin_1000:{x:7,y:1,width:1,height:1},coin_10000:{x:8,y:1,width:1,height:1},coin_100000:{x:9,y:1,width:1,height:1},coin_1000000:{x:10,y:1,width:1,height:1},up_power:{x:6,y:0,width:1,height:1},up_oxygen:{x:7,y:0,width:1,height:1},up_speed:{x:8,y:0,width:1,height:1},up_pull:{x:9,y:0,width:1,height:1},up_push:{x:10,y:0,width:1,height:1},up_slow:{x:11,y:0,width:1,height:1},shark_0:{x:0,y:4,width:1,height:1},shark_1:{x:1,y:4,width:1,height:1},shark_2:{x:2,y:4,width:1,height:1},shark_3:{x:3,y:4,width:1,height:1},shark_4:{x:4,y:4,width:1,height:1},shark_5:{x:5,y:4,width:1,height:1},shark_6:{x:6,y:4,width:1,height:1},shark_alive:["shark_1","shark_2","shark_3","shark_4","shark_5","shark_5","shark_4","shark_3","shark_2","shark_1"],shark_weak:["shark_6"],shark_dead:["shark_0"],octopus_0:{x:0,y:5,width:1,height:1},octopus_1:{x:1,y:5,width:1,height:1},octopus_2:{x:2,y:5,width:1,height:1},octopus_3:{x:3,y:5,width:1,height:1},octopus_4:{x:4,y:5,width:1,height:1},octopus_5:{x:5,y:5,width:1,height:1},octopus_6:{x:6,y:5,width:1,height:1},octopus_alive:["octopus_1","octopus_2","octopus_3","octopus_4","octopus_5","octopus_5","octopus_4","octopus_3","octopus_2","octopus_1"],octopus_weak:["octopus_6"],octopus_dead:["octopus_0"],player_alive:[{x:1,y:3,width:1,height:1},{x:2,y:3,width:1,height:1},{x:3,y:3,width:1,height:1},{x:4,y:3,width:1,height:1},{x:5,y:3,width:1,height:1},{x:4,y:3,width:1,height:1},{x:3,y:3,width:1,height:1},{x:2,y:3,width:1,height:1}],player_dead:[{x:2,y:3,width:1,height:1},{x:6,y:3,width:1,height:1},{x:0,y:3,width:1,height:1},{x:2,y:3,width:1,height:1},{x:6,y:3,width:1,height:1},{x:0,y:3,width:1,height:1},{x:2,y:3,width:1,height:1},{x:6,y:3,width:1,height:1},{x:0,y:3,width:1,height:1},{x:0,y:3,width:1,height:1}],up:{0:{x:13.5,y:1.75,width:1,height:.3},1:{x:13.25,y:1.75,width:1,height:.3},2:{x:13,y:1.75,width:1,height:.3},3:{x:12.75,y:1.75,width:1,height:.3},4:{x:12.5,y:1.75,width:1.25,height:.3},5:{x:12.25,y:1.75,width:1.5,height:.3},6:{x:12,y:1.75,width:1.5,height:.3}},cursor:{x:1,y:0,width:1,height:1},oxygen:{x:2,y:.05,width:2,height:.4,left:.125,right:.125},powerup:{x:2,y:.55,width:2,height:.4,left:.125,right:.125},bubble:{x:4,y:0,width:1,height:1},power:{x:5,y:0,width:1,height:1},d:{0:{x:0,y:2.05,width:4.7/16,height:.4},1:{x:6.5-6,y:2.05,width:3.1/16,height:.4},2:{x:1,y:2.05,width:4.5/16,height:.4},3:{x:7.5-6,y:2.05,width:4.3/16,height:.4},4:{x:2,y:2.05,width:5/16,height:.4},5:{x:8.5-6,y:2.05,width:4.4/16,height:.4},6:{x:3,y:2.05,width:4.7/16,height:.4},7:{x:9.5-6,y:2.05,width:4.5/16,height:.4},8:{x:4,y:2.05,width:4.8/16,height:.4},9:{x:10.5-6,y:2.05,width:4.8/16,height:.4},"-":{x:5,y:2.05,width:3/16,height:.4},".":{x:11.5-6,y:2.05,width:2/16,height:.4},k:{x:6,y:2.05,width:4/16,height:.4},M:{x:12.5-6,y:2.05,width:7/16,height:.4},$:{x:7,y:2.05,width:6/16,height:.4},">":{x:13.5-6,y:2.05,width:6/16,height:.4},"?":{x:8,y:2.05,width:8/16,height:.4}," ":{x:14.5-6,y:2.05,width:5/16,height:.4}},di:{0:{x:0,y:2.55,width:4.7/16,height:.4},1:{x:6.5-6,y:2.55,width:3.1/16,height:.4},2:{x:1,y:2.55,width:4.5/16,height:.4},3:{x:7.5-6,y:2.55,width:4.3/16,height:.4},4:{x:2,y:2.55,width:5/16,height:.4},5:{x:8.5-6,y:2.55,width:4.4/16,height:.4},6:{x:3,y:2.55,width:4.7/16,height:.4},7:{x:9.5-6,y:2.55,width:4.5/16,height:.4},8:{x:4,y:2.55,width:4.8/16,height:.4},9:{x:10.5-6,y:2.55,width:4.8/16,height:.4},"-":{x:5,y:2.55,width:3/16,height:.4},".":{x:11.5-6,y:2.55,width:2/16,height:.4},k:{x:6,y:2.55,width:4/16,height:.4},M:{x:12.5-6,y:2.55,width:7/16,height:.4},$:{x:7,y:2.55,width:6/16,height:.4},">":{x:13.5-6,y:2.55,width:6/16,height:.4},"?":{x:8,y:2.55,width:8/16,height:.4}," ":{x:14.5-6,y:2.55,width:5/16,height:.4}},border:{x:14.1,y:4,width:.8,height:1,top:1/8,bottom:1/8,left:1/8,right:1/8}}};class Ke extends m{constructor(){super(),this.handleActivate=async()=>{await $t(Ge),this.emit("stage-ready")},this.on("activate",this.handleActivate)}}class $e extends m{constructor(){super(),this.key="ocean-data",this.handleActivate=()=>{this.context.user=new Me,this.load()},this.load=()=>{const t=this.loadLocal();if(t){if(t.upgrades)for(let e=0;e<F.length;e++){const s=F[e];this.context.user.upgrades[s]=t.upgrades[s]??0}this.context.user.upgrades.bookmarks=t.upgrades.bookmarks??0,t.stats&&(this.context.user.stats.coins=t.stats.coins??0,this.context.user.stats.dist=t.stats.dist??0),this.context.user.bookmarks=t.bookmarks??[],this.emit("data-load")}},this.loadLocal=()=>{const t=this.key;try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){console.log(e)}return null},this.handleDataSave=()=>{const t=this.context.user,e=this.key;try{const s=JSON.stringify(t);localStorage.setItem(e,s)}catch(s){console.log(s)}this.emit("data-load")},this.on("activate",this.handleActivate),this.on("data-save",this.handleDataSave)}}class Je extends m{constructor(){super(),this.use(new we),this.use(new Ke),this.use(new $e),this.use(new Se),this.use(new Ve)}}m.activate(new Je,{});
